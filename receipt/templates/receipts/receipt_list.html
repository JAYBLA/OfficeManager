{% extends 'base.html' %}
{% load static %}
{% block title %}Receipts{% endblock title %}

{% block stylesheet %}

{% endblock stylesheet %}


{% block content %}
<div class="card">
    <div class="card-header">   
        <h2 class="py-2">{{heading}}
            <button class="btn btn-outline-primary btn-lg float-right create-receipt">New Receipt</button> 
        </h2>
      </div>
      <div class="card-body">
        <div class="table-responsive">
            <table class="table" id="items-lis-table">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Customer</th>
                        <th>Date</th>
                        <th>Amount</th>
                        <th>Status</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                {% include 'receipts/includes/receipt_list_body.html' %}
                </tbody>
            </table>
      </div>
      </div>
  </div>

  <!-- THE MODAL-->
<div class="modal fade" id="modal-receipt" data-backdrop="static">
    <div class="modal-dialog">
      <div class="modal-content">
      </div>
    </div>
</div>
{% endblock content %}


{% block javascript %}
<script>
    $(function () {

        $(".create-receipt").click(function () {
          $.ajax({
            url: "{% url 'receipt:receipt_create' %}",
            type: 'get',
            dataType: 'json',
            beforeSend: function () {
              $("#modal-receipt").modal("show");
            },
            success: function (data) {
              $("#modal-receipt .modal-content").html(data.html_receipt_form);
            }
          });
        });
      
      });
</script>
<script>
  $("#modal-receipt").on("submit", ".receipt-create-form", function () {
    var form = $(this);
    $.ajax({
      url: form.attr("action"),
      data: form.serialize(),
      type: form.attr("method"),
      dataType: 'json',
      success: function (data) {
        if (data.form_is_valid) {
          $("#items-lis-table tbody").html(data.html_receipt_list);  // <-- Replace the table body
          toastr.options = {
            "closeButton": false,
            "debug": false,
            "newestOnTop": false,
            "progressBar": true,
            "positionClass": "toast-top-center",
            "preventDuplicates": false,
            "onclick": null,
            "showDuration": "300",
            "hideDuration": "1000",
            "timeOut": "3000",
            "extendedTimeOut": "1000",
            "showEasing": "swing",
            "hideEasing": "linear",
            "showMethod": "fadeIn",
            "hideMethod": "fadeOut"
          }
          toastr["success"]("Receipt Created")
          $("#modal-receipt").modal("hide");
          form.reset()
        }

        else {
          $("#modal-receipt .modal-content").html(data.html_form);
        }
      }
    });
    return false;
  });
</script>
{% endblock javascript %}
    
    